<html>
  <head>
    <title>W3Clove report for <%= @url %></title>
    <link href='http://fonts.googleapis.com/css?family=Cabin+Sketch:bold' rel='stylesheet' type='text/css'>
    <style type="text/css">
      #header, #main, #footer {
        padding: 5px; margin: 5px;
        background-color: #eee;
        border: 1px solid black;
      }
      #header, h1, h2, h3 {
        font-family: 'Cabin Sketch', arial, serif;
      }
      #header {
        font-size: 2.5em;
      }
      #footer {
        font-size: .85em;
        text-align: center;
      }
      .page {
        padding: 5px; margin: 5px;
        border: 1px solid black;
        background-color: white;
      }
    </style>
  </head>
  <body>
    <div id="header">
      W3Clove :: site-wide markup validation
    </div>

    <div id="main">
      <h1>Report for <%= @url %></h1>

      <h2>SITEMAP SUMMARY</h2>
      <p>TOTAL: <%= errors.length %> errors, <%= warnings.length %> warnings.</p>

      <% if errors.length > 0 %>
        <h2>POPULAR ERRORS</h2>
        <ul>
        <% errors.group_by {|e| e.message_id}.sort_by {|m,e| e.length}.reverse.each do |message_id, errors| %>
          <li>error <a href="http://validator.w3.org/docs/errors.html#ve-<%= message_id %>"><%= message_id %></a> happens <%= errors.length %> times</li>
        <% end %>
        </ul>
      <% end %>

      <% if warnings.length > 0 %>
        <h2>POPULAR WARNINGS</h2>
        <ul>
        <% warnings.group_by {|w| w.message_id}.sort_by {|m,w| w.length}.reverse.each do |message_id, warnings| %>
          <li>warning <a href="http://validator.w3.org/docs/errors.html#ve-<%= message_id %>"><%= message_id %></a> found <%= warnings.length %> times</li>
        <% end %>
        </ul>
      <% end %>

      <% processed_pages = pages.select{|p| !p.exception} %>
      <% if processed_pages.size > 0 %>
        <h2>DETAILS PER PAGE</h2>
        <% processed_pages.each do |page| %>
          <div class='page'>
            <h3><%= page.url %></h3>
            <p class='page_summary'>
              <%= "#{page.errors.length} errors, #{page.warnings.length} warnings" %>
            </p>

            <ul class="page_errors">
            <% page.errors.each do |error| %>
              <li>
                Error <a href="http://validator.w3.org/docs/errors.html#ve-<%= error.message_id %>"><%= error.message_id %></a> on line <%= error.line %>:
                <%= error.text %>
              </li>
            <% end %>
            </ul>

            <ul class="page_warnings">
            <% page.warnings.each do |warning| %>
              <li>
                Warning <a href="http://validator.w3.org/docs/errors.html#ve-<%= warning.message_id %>"><%= warning.message_id %></a> on line <%= warning.line %>:
                <%= warning.text %>
              </li>
            <% end %>
            </ul>
          </div>
        <% end %>
      <% end %>
    </div>

    <div id="footer">
      <strong>w3clove</strong>@2011 <a href='http://jaimeiniesta.com'>Jaime Iniesta</a>. Get w3clove from <a href="http://github.com/jaimeiniesta/w3clove">github</a>.
    </div>
  </body>
</html>
